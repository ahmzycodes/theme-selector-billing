<!DOCTYPE html>
<html>
<head>
  <title>Payment Success</title>
</head>
<body>
  <h2>Payment Successful ðŸŽ‰</h2>
  <p>Verifying your subscriptionâ€¦</p>

  <script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabase = createClient(
  'https://qwpiggqeyctejvrgjxim.supabase.co', 
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3cGlnZ3FleWN0ZWp2cmdqeGltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MTgwMjMsImV4cCI6MjA4NjA5NDAyM30.ZLUSkcb8fPtb6VoR4fIeQUEuZhG1cwPrjajll-Tw12Y' // my anon key
)

async function verifyPayment() {
  const params = new URLSearchParams(window.location.search)
  const session_id = params.get('session_id')

  if (!session_id) {
    document.body.innerHTML = "Missing session id."
    return
  }

  const { data, error } = await supabase.functions.invoke('verify-stripe-session', {
    body: { session_id }
  })

  if (error) {
    document.body.innerHTML = "Server error."
    console.error(error)
    return
  }

  if (data.success) {
    document.body.innerHTML = "âœ… Pro unlocked. You can close this page."
  } else {
    document.body.innerHTML = "Verification failed. Contact support."
  }
}

verifyPayment()
</script>

</body>
</html>
